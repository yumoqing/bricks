class _TypeIcons{constructor(){this.kv={}}get(t,e){return this.kv.get(t,e)}register(t,e){this.kv[t]=e}}TypeIcons=new _TypeIcons;var currentScriptPath=function(){var t;if(document.currentScript)t=document.currentScript.src,console.log("has currentScriot");else{console.log("has not currentScriot");var e=document.querySelectorAll("script[src]");if(e.length<1)return null;t=e[e.length-1].src}console.log("currentScript=",t);e=t.split("/"),e=e[e.length-1];return t.replace(e,"")},bricks_path=currentScriptPath(),bricks_resource=function(t){return bricks_path+t};function querySelectorAllShadows(e,t=document.body){var s=Array.from(t.querySelectorAll("*")).map(t=>t.shadowRoot).filter(Boolean),s=(console.log("[querySelectorAllShadows]",e,t,`(${s.length} shadowRoots)`),s.map(t=>querySelectorAllShadows(e,t)));return Array.from(t.querySelectorAll(e)).concat(s).flat()}var schedule_once=function(t,e){e*=1e3,window.setTimeout(t,e)},schedule_interval=function(s,t){schedule_once(function(t,e){t(),schedule_once(s,e)}.bind(s,t),t)},debug=function(){console.log(...arguments)},import_cache=new Map,import_css=async function(t){var e,s;1!==import_cache.get(t)&&(e=await tget(t),debug("import_css():tget() return",e),(s=document.createElement("style")).setAttribute("type","text/javascript"),s.innerHTML=e,document.getElementsByTagName("head")[0].appendChild(s),import_cache.set(t,1))},import_js=async function(t){var e;1!==import_cache.get(t)&&((e=document.createElement("script")).setAttribute("type","text/javascript"),e.src=t,document.body.appendChild(e),import_cache.set(t,1))},extend=function(t,e){for(var s in e)e.hasOwnProperty(s)&&(t[s]&&"object"==typeof t[s]&&"[object Object]"==t[s].toString()&&e[s]?extend(t[s],e[s]):t[s]=e[s]);return t},objget=function(t,e,s){return t.hasOwnProperty(e)?t[e]:s},obj_fmtstr=function(i,t){return t.replace(/\${(\w+)([:=]*)}/g,(t,e,s)=>i.hasOwnProperty(e)?""==s?i[e]:e+s+i[e]:"")},archorize=(Object.prototype.copy=function(){var t={};for(k in this)this.hasOwnProperty(k)&&(t[k]=this[k]);return t},Object.prototype.get=function(t,e){return objget(this,t,e)},Object.prototype.fmtstr=function(t){return obj_fmtstr(this,t)},Object.prototype.update=function(t){extend(this,t)},function(t,e){var s=(e=e||"cc")[0],e=e[1],i="0%";switch(s){case"t":i="0%";break;case"b":i="100%";break;default:i="50%"}var o="0%";switch(e){case"l":o="0%";break;case"r":o="100%";break;default:o="50%"}t.style.top=i;s={x:t.style.left=o,y:i}.fmtstr("translateY(-${y}) translateX(-${x})");console.log("archorize(): tsf=",s),t.style.transform=s,t.style.position="absolute"});Array.prototype.insert=function(t,...e){this.splice(t,0,...e)},Array.prototype.remove=function(t){t=this.indexOf(t);return 0<=t&&this.splice(t,1),this};class I18n{constructor(t,e){this.url=opts.url,this.default_lang=opts.default_lang||"en",this.method=opts.method||"GET",this.lang_msgs={},this.msgs={}}_(t,e){return this.msgs.hasOwnProperty(t)&&(itxt=this.msgs[t]),e instanceof Object?e.fmtstr(itxt):t}is_loaded(t){return!!this.lang_msgs.get(t)}setup_dict(t,e){this.cur_lang=e,this.lang_msgs.update({lang:t}),this.msgs=t}async change_lang(t){this.lang_msgs.get(t)?this.msgs=this.lang_msgs.get(t):this.url&&(d=await jcall(desc.url,{method:this.method||"GET",params:{lang:t}}),this.setup_dict(d,t))}}class Factory_{constructor(){this.widgets_kv=new Object,this.widgets_kv._t_=1,console.log("kv=",this.widgets_kv)}register(t,e){this.widgets_kv[t]=e}get(t){return this.widgets_kv.hasOwnProperty(t)?this.widgets_kv[t]:null}}const Factory=new Factory_;class JsWidget{dom_element=null;constructor(t){this.opts=t,this._container=!1,this.parent=null,this.sizable_elements=[]}sizable(){bricks_app.text_ref(this)}change_fontsize(t){if(!this.specified_fontsize){this.dom_element.style.fontSize=t;for(var e=0;e<this.sizable_elements.length;e++)this.sizable_elements[e].style.fontSize=t}}set_fontsize(){var t=this.opts.fontsize?(this.specified_fontsize=!0,this.opts.fontsize):bricks_app.get_textsize(this.ctype);this.dom_element.style.fontSize=t;for(var e=0;e<this.sizable_elements.length;e++)this.sizable_elements[e].style.fontSize=t}h_center(){this.dom_element.style.marginLeft="auto",this.dom_element.style.marginRight="auto"}h_left(){this.dom_element.style.marginLeft="0px",this.dom_element.style.marginRight="auto"}h_right(){this.dom_element.style.marginLeft="auto",this.dom_element.style.marginRight="0px"}ht_center(){this.dom_element.style.textAlign="center"}ht_left(){this.dom_element.style.textAlign="left"}ht_right(){this.dom_element.style.textAlign="right"}set_width(t){this.dom_element.style.width=t}set_height(t){this.dom_element.style.height=t}set_css(t){this.dom_element.classList.add(t)}set_cssObject(t){this.dom_element.style.update(t)}is_container(){return this._container}create(t){this.dom_element=document.createElement(t),this.dom_element.bricks_widget=this}_create(t){return document.createElement(t)}set_id(t){this.dom_element.id=t}set_baseURL(t){this.baseURL=t}show(){this.dom_element.style.display=""}hide(){this.dom_element.style.display="none"}bind(t,e){this.dom_element.addEventListener(t,e)}unbind(t,e){this.dom_element.removeEventListener(t,e)}dispatch(t,e){t=new Event(t);t.params=e,this.dom_element.dispatchEvent(t)}}class TextBase extends JsWidget{constructor(t){super(t),this.opts=t,this.specified_fontsize=!1,this.create("div"),this.set_attrs(),this.dom_element.style.fontWeight="bold",this.sizable()}set_attrs(){this.opts.hasOwnProperty("text")&&(this.text=this.opts.text),this.opts.hasOwnProperty("otext")&&(this.otext=this.opts.otext,console.log("otext=",this.opts.otext,this.otext)),this.opts.hasOwnProperty("i18n")&&(this.i18n=this.opts.i18n),this._i18n=new I18n,this.i18n&&this.otext&&(this.text=this._i18n._(this.otext),console.log("otext=",this.otext,"text=",this.text)),this.dom_element.innerHTML=this.text}set_i18n_text(){this.otext&&this.i18n&&(this.text=this._i18n._(this.otext),this.dom_element.innerHTML=this.text)}}class Text extends TextBase{constructor(t){super(t),this.ctype="text",this.set_fontsize()}}class Title1 extends TextBase{constructor(t){super(t),this.ctype="title1",this.set_fontsize(),this.dom_element.style.fontWeight="bold"}}class Title2 extends TextBase{constructor(t){super(t),this.ctype="title2",this.set_fontsize(),this.dom_element.style.fontWeight="bold"}}class Title3 extends TextBase{constructor(t){super(t),this.ctype="title3",this.set_fontsize(),this.dom_element.style.fontWeight="bold"}}class Title4 extends TextBase{constructor(t){super(t),this.ctype="title4",this.set_fontsize(),this.dom_element.style.fontWeight="bold"}}class Title5 extends TextBase{constructor(t){super(t),this.ctype="title5",this.set_fontsize(),this.dom_element.style.fontWeight="bold"}}class Title6 extends TextBase{constructor(t){super(t),this.ctype="title6",this.set_fontsize(),this.dom_element.style.fontWeight="bold"}}Factory.register("Text",Text),Factory.register("Title1",Title1),Factory.register("Title2",Title2),Factory.register("Title3",Title3),Factory.register("Title4",Title4),Factory.register("Title5",Title5),Factory.register("Title6",Title6);let bricks_app=null;var widgetBuild=async function(e){"urlwidget"===e.widgettype&&(i=e.options.url,t=e.options.method||"GET",s=e.options.params||{},e=await jcall(i,{method:t,params:s}));var t,s,i=Factory.get(e.widgettype);if(!i)return console.log("widgetBuild():",e.widgettype,"not registered",Factory.widgets_kw),null;var o=new i(e.options);if(e.hasOwnProperty("id")&&o.set_id(e.id),e.hasOwnProperty("subwidgets"))for(let t=0;t<e.subwidgets.length;t++){var a=e.subwidgets[t],n=await widgetBuild(a);n?o.add_widget(n):console.log("widgetBuild() error: sdesc=",a)}if(e.hasOwnProperty("binds"))for(var r=0;r<e.binds.length;r++)buildBind(o,e.binds[r]);return o},buildBind=function(t,e){var s,i=getWidgetById(e.wid,t),t=buildEventHandler(t,e);t?(e.conform&&((s=widgetBuild(e.conform)).bind("on_conform",t),t=s.open.bind(s)),i.bind(e.event,t)):console.log("buildBind(): handler is null",e)},buildEventHandler=function(t,e){var s=getWidgetById(e.target,t);if(!s)return console.log("target miss",e),null;var i,o=null;switch(e.datawidget&&(i={widget:e.datawidget,method:e.datamethod,params:e.dataparams,script:e.datascript},o=getRealtimeData(i)),e.actiontype){case"bricks":return buildBricksHandler(t,s,o,e);case"registerfunction":return buildRegisterFunction(t,s,o,e);case"method":return buildMethodHandler(t,s,o,e);case"script":return buildScriptHandler(t,s,o,e);case"event":return buildDispatchEventHandler(t,s,o,e);default:console.log("invalid actiontype",s,e)}},buildBrickHandler=function(t,e,s,i){var o={};return o.update(i.options),(o.params||s)&&o.update(o.params.update(s)),function(t,e,s){s=widgetBuild(s);"replace"==e&&t.clear_widgets(),t.add_widget(s)}.bind(e,i.mode||"replace",o)},buildRegisterFunctionHandler=function(t,e,s,i){var o,a=registerfunctions.get(i.rfname);return a?(o=i.params||{},s&&o.update(s),a.bind(e,o)):(console.log("rfname:",i.rfname,"not registed",i),null)},buildMethodHandler=function(t,e,s,i){var o=e[i.method],i=i.params||{};return s&&i.update(s),o.bind(e,i)},buildScriptHandler=function(t,e,s,i){var o=i.params||{};return s&&o.update(s),new Function("target","params","event",i.script).bind(e,o)},buildDispatchEventHandler=function(t,e,s,i){i=i.params||{};s&&i.update(s);return function(t,e,s){t.dispatch(e,s)}.bind(e,i)},getWidgetById=function(e,t){if(!e)return t;for(var s,i=e.split("/"),o=t.dom_element,a=0,n=0;n<i.length;n++){if(0==a){if(a=1,"self"==i[n]){o=t.dom_element;continue}if("root"==i[n]){o=bricks_app.root.dom_element;continue}if("app"==i[n])return bricks_app;if("window"==i[n]){o=Body.dom_element;continue}}try{o="-"==i[n][0]?(s=substr(1,i[n].length-1),o.closest("#"+s)):o.querySelector("#"+i[n])}catch(t){return console.log("getWidgetById():i=",i[n],e,"not found",t),null}if(null==o)return console.log("getWidgetById():",e,o),null}return void 0!==o.bricks_widget?(console.log("getWidgetById():",e,o,"widget"),o.bricks_widget):o};class BricksApp{constructor(t){this.opts=t,(bricks_app=this).charsize=this.opts.charsize||20,this.opts.language?this.lang=this.opts.language:this.lang=navigator.language,this.textList=[],this.i18n=new I18n(t.get("i18n",{}))}get_textsize(t){var e=this.charsize;return parseInt({text:1,title1:1.96,title2:1.8,title3:1.64,title4:1.48,title5:1.32,title6:1.16}[t]*e)+"px"}text_ref(t){this.textList.push(new WeakRef(t))}text_remove_dead(){for(var t=this.textList,e=0;e<t.length;e++)t[e].deref()||this.textList.remove(t[e])}async setup_i18n(){var t={lang:this.lang};d=await jcall(desc.url,{method:desc.method||"GET",params:t}),this.i18n.setup_dict(d)}async build(){var t=structuredClone(this.opts.widget);return await widgetBuild(t)}async run(){await this.change_language(this);var t=await this.build();this.root=t,Body.add_widget(t)}textsize_bigger(){this.charsize=1.05*this.charsize,this.text_resize()}textsize_smaller(){this.charsize=.95*this.charsize,this.text_resize()}text_resize=function(){for(var t,e,s=0;s<this.textList.length;s++)this.textList[s].deref()&&(t=this.textList[s].deref(),e=this.get_textsize(t.ctype),t.change_fontsize(e))};change_language=async function(t){this.lang=t,await this.i18n.change_lang(t);for(var e,s=0;s<this.textList.length;s++)this.textList[s].deref()&&(e=this.textList[s].deref()).opts.i18n&&e.set_i18n_text()}}class Image extends JsWidget{constructor(t){super(t),this.opts=t,this.create("img"),this.options_parse()}options_parse(){this.opts.hasOwnProperty("source")&&this.set_source(this.opts.source),this.opts.hasOwnProperty("width")&&(this.width=this.opts.width,this.dom_element.style.width=this.width),this.opts.hasOwnProperty("height")&&(this.height=this.opts.height,this.dom_element.style.height=this.height)}set_source(t){this.source=t,this.dom_element.src=t}}class Icon extends Image{constructor(t){super(t),this.opts.width=bricks_app.charsize,this.opts.height=bricks_app.charsize,this.ctype="text",this.sizable(),this.set_fontsize()}change_fontsize(t){var e=bricks_app.charsize;this.set_width(e),this.set_height(e)}set_fontsize(){var t=bricks_app.charsize;this.set_width(t),this.set_height(t)}}class BlankIcon extends JsWidget{constructor(t){super(t),this.create("div"),this.opts.width=bricks_app.charsize,this.opts.height=bricks_app.charsize,this.ctype="text",this.sizable(),this.set_fontsize()}change_fontsize(t){var e=bricks_app.charsize;this.set_width(e),this.set_height(e)}set_fontsize(){var t=bricks_app.charsize;this.set_width(t),this.set_height(t)}}function url_params(e){return Object.keys(e).map(t=>t+"="+encodeURIComponent(e[t])).join("&")}Factory.register("Image",Image),Factory.register("Icon",Icon),Factory.register("BlankIcon",BlankIcon);class HttpText{constructor(t){this.headers=(t=t||{})||{Accept:"text/html"},this.headers.update(t),this.params={_webbricks_:1}}async get_result_data(t){return t.text()}add_own_params(t){if((t=t||{})instanceof FormData)for(var[e,s]of Object.entries(this.params))t.append(e,s);else t=Object.assign(this.params,t);return t}add_own_headers(t){return t=t||{},Object.assign(this.headers,t)}async httpcall(t,{method:e="GET",headers:s=null,params:i=null}={}){var o=this.add_own_params(i),s=(this.add_own_headers(s),{method:e}),o=("GET"==e||"HEAD"==e?t=t+"?"+url_params(o):o instanceof FormData?s.body=o:s.body=JSON.stringify(o),await fetch(t,s)),s=await this.get_result_data(o);if(o.ok)return console.log("method=",e,"url=",t,"params=",i),console.log("result=",s),s;console.log("method=",e,"url=",t,"params=",i),console.log("jsoncall error:");o={type:"Error",message:s.message||"Something went wrong",data:s.data||"",code:s.code||""},e=new Error;return e.info=o,e}async get(t,{headers:e=null,params:s=null}={}){return this.httpcall(t,{method:"GET",headers:e,params:s})}async post(t,{headers:e=null,params:s=null}={}){return this.httpcall(t,{method:"POST",headers:e,params:s})}}class HttpJson extends HttpText{constructor(t){super(t=t||{}),this.headers={Accept:"application/json"},this.headers.update(t)}async get_result_data(t){return t.json()}}var hc=new HttpText,tget=hc.get.bind(hc),tpost=hc.post.bind(hc),jcall=(jc=new HttpJson).httpcall.bind(jc),jget=jc.get.bind(jc),jpost=jc.post.bind(jc);class Oper{constructor(t){this.value=t}__plus__(t,e){return console.log(t,e),new Oper(t.value+e.value)}__add__(t,e){return console.log(t,e),new Oper(t.value+e.value)}}class Layout extends JsWidget{constructor(t){super(t),this._container=!0,this.children=[],this.create("div")}opts_handle(){var t=this.dom_element;this.opts.width&&(t.style.width=this.opts.width),this.opts.height&&(t.style.height=this.opts.height),this.opts.css&&this.dom_element.classList.add(this.opts.css)}add_widget(t,e){var s;!e||e>=this.children.length?((t.parent=this).children.push(t),this.dom_element.appendChild(t.dom_element)):(s=this.children[e],this.dom_element.insertBefore(t.dom_element,s.dom_element),this.children.insert(e+1,t))}remove_widget(e){e.parent=null,this.children=this.children.filter(function(t){return t!==e}),this.dom_element.removeChild(e.dom_element)}clear_widgets(t){for(var e=0;e<this.children.length;e++)this.children[e].parent=null;this.children=[],this.dom_element.replaceChildren()}}class _Body extends Layout{constructor(t){super(t),this.dom_element=document.getElementsByTagName("body")[0]}}Body=new _Body;class BoxLayout extends Layout{constructor(t){super(t),this.create("div"),this.opts_handle(),this.container_jss={display:"flex"},this.child_jss={},this.orientation=t.get("orientation","vertical"),this.orientation in["vertical","horizontal"]&&(this.orientation="vertical")}}class VBox extends BoxLayout{constructor(t){super(t),this.orientation="vertical",this.container_jss.flexFlow="column",this.dom_element.style.update(this.container_jss)}add_widget(t,e){var s=t.dom_element;BoxLayout.prototype.add_widget.call(this,t,e),t.opts.height?s.style.flex=obj_fmtstr({height:t.opts.height},"0 1 ${height}"):s.style.flex="1 1 auto"}}class HBox extends BoxLayout{constructor(t){super(t),this.orientation="horizontal",this.container_jss.flexFlow="row",this.dom_element.style.update(this.container_jss)}add_widget(t,e){var s=t.dom_element;BoxLayout.prototype.add_widget.call(this,t,e),t.opts.width?s.style.flex=obj_fmtstr({width:t.opts.width},"0 1 ${width}"):s.style.flex="1 1 auto"}}Factory.register("HBox",HBox),Factory.register("VBox",VBox);class Menu extends VBox{constructor(t){super(t),this.create("div"),this.dom_element.style.display="",this.dom_element.style.position="absolute",this.dom_element.style.backgroundColor=t.bgcolor||"white",this.dom_element.style.zIndex="1000",this.create_children(this.dom_element,this.opts.items),this.bind("click",this.menu_clicked)}create_submenu_container(){var t=document.createElement("div");return t.style.marginLeft="15px",t.style.display="none",t}async menu_clicked(t){var e=t.target;if(0<e.children.length)for(var s=0;s<e.children.length;s++)"none"==e.children[s].style.display?e.children[s].style.display="":e.children[s].style.display="none";else console.log("item clicked")}create_children(e,s){console.log("create_children():items=",s,"p=",e);for(let t=0;t<s.length;t++){var i,o=s[t],a=this.create_menuitem(o);e.appendChild(a),o.hasOwnProperty("items")&&(i=this.create_submenu_container(),a.appendChild(i),this.create_children(i,o.items))}}create_menuitem(t){var e=bricks_app.i18n,s=(console.log("i18n=",e),document.createElement("div"));return s.textContent=e._(t.label||t.name),console.log("create_menuitem():item=",t,"obj=",s),s}}Factory.register("Menu",Menu);class Modal extends JsWidget{constructor(t){super(t),this.create()}create(){var t=document.createElement("div"),e=(t.style.display="none",t.style.position="fixed",t.style.zIndex=this.opts.get("org_index",0)+1,t.style.paddingTop="100px",t.style.left=0,t.style.top=0,t.style.width="100%",t.style.height="100%",t.style.backgroundColor=this.opts.get("bgcolor","rgba(0,0,0,0.4)"),this.dom_element=t,document.createElement("div")),t=(e.style.position="absolute",e.style.backgroundColor="rgb(1,0,0)",e.style.width=this.opts.get("width","70%"),e.style.height=this.opts.get("height","70%"),t.appendChild(e),document.createElement("div")),s=(t.style.color="#aaaaaa",t.style.float="right",t.style.fontSize="28px",t.style.fontWeight="bold",t.my_modal=this,t.innerHTML="&times;",t.onclick=function(t){t.target.my_modal.dismiss()},document.createElement("div")),t=(s.style.height="40px",s.style.width="100%",this.opts.titleCSS&&s.classList.add(this.opts.titleCSS),this.opts.title&&s.appendChild(Title3({otext:this.opts.title,i18n:!0})),s.appendChild(t),e.appendChild(s),document.createElement("div"));t.style.overflow="auto",t.style.width="100%",t.style.height="100%",t.style.backgroundColor="rgb(0, 255, 0)",this.opts.contentCSS&&t.classList.add(this.opts.contentCSS),e.appendChild(t),archorize(e,this.opts.get("archor","cc")),this.content=t,(this.dom_element.bricks_widget=this).content.bricks_widget=this}add_widget(t,e){console.log("add_widget():w=",t),e&&this.content.children.length>e?this.content.insertBefore(t.dom_element,this,content.children[e]):this.content.appendChild(t.dom_element),this.opts.auto_open&&this.open()}click_handler(t){console.log("click_handler() called ..."),t.target==this.dom_element?this.dismiss():console.log("modal():click_handler()")}open(){var t;console.log("modal():open called ............"),this.opts.auto_close&&(console.log("modal():auto_close ........"),t=this.click_handler.bind(this),this.bind("click",t)),this.dom_element.style.display=""}dismiss(){this.dom_element.style.display="none",this.opts.auto_close&&this.unbind("click",this.click_handler.bind(this))}}Factory.register("Modal",Modal);class MdText extends JsWidget{constructor(t){super(t),this.create("div");t=this.build.bind(this);this.load_event=new Event("loaded"),schedule_once(t,.01),this.dom_element.style.overFlow="auto",window.addEventListener("scroll",this.show_scroll.bind(this))}show_scroll(t){console.log("scrollY=",window.scrollY)}build=async function(){this._build(this.opts.md_url)};_build=async function(t){for(var e=await tget(t),s=(this.dom_element.innerHTML=marked.parse(e),this.dom_element.getElementsByTagName("a")),i=0;i<s.length;i++){var o=s[i].href;s[i].href="#",s[i].onclick=this._build.bind(this,o)}this.dispatch("loaded",{url:t})}}class MarkdownViewer extends VBox{constructor(t){super(t),this.create("div"),this.back_stack=[],this.opts.navigator&&this.createBackButton(),this.mdtext=new MdText({md_url:this.opts.md_url}),this.add_widget(this.mdtext),this.mdtext.bind("loaded",this.add_back_stack.bind(this)),this.dom_element.style.overflow="auto",this.dom_element.style.height="100%",this.bind("scroll",this.show_scroll.bind(this))}show_scroll(t){console.log("scrollY=",window.scrollY)}createBackButton=async function(){var t={widgettype:"HBox",options:{},subwidgets:[{widgettype:"Text",options:{text:"<<<<<<<"}}]},e=await widgetBuild(t),s=(console.log("createBackButton():error, desc=",t,"w=",e),e.children[0]);console.log("createBackButton():text=",s),s.bind("click",this.go_back.bind(this)),this.add_widget(e),console.log("createBackButton():desc=",t,"w=",e)};add_back_stack(t){console.log("go_back_stack():event=",t);t=t.params.url;this.back_stack.push(t)}go_back=async function(t){var e;this.back_stack.length<2||(this.back_stack.pop(),e=this.back_stack.pop(),await this.mdtext._build(e))};build=async function(){this._build(this.opts.md_url)};_build=async function(t){for(var t=await tget(t),e=(this.md_el.innerHTML=marked.parse(t),this.md_el.getElementsByTagName("a")),s=0;s<e.length;s++){var i=e[s].href;e[s].href="#",e[s].onclick=this._build.bind(this,i)}}}Factory.register("MarkdownViewer",MarkdownViewer);class Video extends JsWidget{constructor(t){super(t),this.create("video"),this.dom_element.controls=!0,this.opts.url&&(this.dom_element.src=this.opts.url)}}class VideoPlayer extends VBox{constructor(t){super(t),this.create("div");var t="",e=(this.opts.autoplay&&(t="autoplay"),this.opts.url);this.dom_element.innerHTML=`<video width="100%" controls ${t} > 		<source src=${e} /> 		</video>`}}Factory.register("VideoPlayer",VideoPlayer);class AudioPlayer extends JsWidget{constructor(t){super(t),this.create("div"),this.audio=this._create("audio"),this.audio.controls=!0,this.opts.autoplay&&this.audio.addEventListener("canplay",this.play_audio.bind(this)),this.audio.style.width="100%";t=this._create("source");t.src=this.opts.url,this.audio.appendChild(t),this.dom_element.appendChild(this.audio)}play_audio(){var t=querySelectorAllShadows(".play-pause",this.audio);0<t.length&&(t[0].click(),console.log("AudioPlayer():playing ...")),console.log("AudioPlayer():play button not found")}}Factory.register("AudioPlayer",AudioPlayer);class Toolbar extends BoxLayout{constructor(t){super(t),this.create("div"),this.toolList=[],"vertical"==this.opts.orientation?(this.bar=new VBox(t),this.dom_element.classList.add("vtoolbar")):(this.bar=new HBox(t),this.dom_element.classList.add("htoolbar")),this.add_widget(this.bar),this.preffix_css=this.opts.css||"toolbar",schedule_once(this.createTools.bind(this),.01)}createTools=async function(){for(var t=0;t<this.opts.tools.length;t++)await this.createTool(this.opts.tools[t]);this.dispatch("ready")};createTool=async function(t){var e={widgettype:"Button",options:{orientation:"horizontal",icon:t.icon,text:t.label,name:t.name,css:t.css}},s=(console.log("options=",e,"---------",t),await widgetBuild(e));if(s)return s.bind("click",this.do_handle.bind(this,s)),s.tool_opts=t,this.add_removable(s),this.toolList.push(s),this.bar.add_widget(s),s;console.log("Toolbar(): build widget failed",e)};remove_item(t,e){this.bar.remove_widget(t),this.toolList.remove(t),t.unbind("click",this.do_handle.bind(this,t)),this.dispatch("remove",t.tool_opts),e.preventDefault(),e.stopPropagation()}do_handle(t,e){console.log("Toolbar() onclock,target=",e.target,t);new Event("command");e={};e.update(t.tool_opts),this.opts.target&&(e.target=this.opts.target),this.dispatch("command",e);for(var s=0;s<this.toolList.length;s++)this.toolList[s].dom_element.classList.remove(this.preffix_css+"-button-active");t.dom_element.classList.add(this.preffix_css+"-button-active")}add_removable(t){var e,s;t.tool_opts.removable&&(s={source:e=currentScriptPath()+"imgs/delete.png",width:"24px",heigh:"24px"},(s=new Image(s))?(t.add_widget(s),s.bind("click",this.remove_item.bind(this,t)),console.log("Toolbar(): add_removable() for ",e)):console.log("Toolbar(): Image create error",e))}click(t){for(var e=0;e<this.toolList.length;e++)t==this.toolList[e].tool_opts.name&&this.toolList[e].dom_element.click()}}Factory.register("Toolbar",Toolbar);class TabPanel extends Layout{constructor(t){super(t),this.content_buffer={},this.cur_tab_name="",this.content_container=new VBox({}),this.dom_element.style.width="100%",this.dom_element.style.height="100%","top"==this.opts.tab_pos||"bottom"==this.opts.tab_pos?(this.panel=new VBox({}),t=this.opts.tab_wide||"45px",this.tab_container=new VBox({height:t}),this.tab_container.dom_element.style.width=this.opts.tab_long||"100%"):(this.panel=new HBox({}),t=this.opts.tab_wide||"70px",this.tab_container=new VBox({width:t}),this.tab_container.dom_element.style.height=this.opts.tab_long||"100%"),"top"==this.opts.tab_pos||"left"==this.opts.tab_pos?(this.panel.add_widget(this.tab_container),this.panel.add_widget(this.content_container)):(this.panel.add_widget(this.content_container),this.panel.add_widget(this.tab_container)),this.panel.dom_element.style.width="100%",this.panel.dom_element.style.height="100%",this.add_widget(this.panel),this.createToolbar(),this.panel.dom_element.classList.add("tabpanel"),this.content_container.dom_element.classList.add("tabpanel-content")}show_first_tab(){this.show_content_by_tab_name(this.opts.items[0].name)}show_content_by_tab_name(t){this.toolbar.click(t)}createToolbar(){var t={tools:this.opts.items},e="top"==this.opts.tab_pos||"bottom"==this.opts.tab_pos?"horizontal":"vertical";t.orientation=e,this.toolbar=new Toolbar(t),this.toolbar.bind("command",this.show_tabcontent.bind(this)),this.toolbar.bind("remove",this.tab_removed.bind(this)),this.toolbar.bind("ready",this.show_first_tab.bind(this)),this.tab_container.add_widget(this.toolbar)}show_tabcontent=async function(t){var e=t.params,s=this.opts.items;if(e.name==this.cur_tab_name)console.log("TabPanel(): click duplication click on same tab",e);else{for(var i,o=0;o<s.length;o++)if(e.name==s[o].name)return(i=this.content_buffer.get(e.name))&&!s[o].refresh?(this.content_container.clear_widgets(),this.content_container.add_widget(i),void(this.cur_tab_name=name)):(i=await widgetBuild(s[o].content))?(this.content_buffer[e.name]=i,this.content_container.clear_widgets(),this.content_container.add_widget(i),void(this.cur_tab_name=e.name)):void console.log("TabPanel():create content error",s[o].content);console.log("TabPanel(): click event handled but noting to do",e)}};add_tab(t){var e=this.toolbar.createTool(t);t.removable&&this.add_removeable(e)}tab_removed(t){t=t.params;this.content_buffer.hasOwnProperty(t.name)&&delete this.content_buffer[t.name],t.name==this.cur_tab_name&&this.show_first_tab()}}Factory.register("TabPanel",TabPanel);class UiType extends Layout{constructor(t){super(t),this.name=this.opts.name,this.required=t.required||!1,this.ctype="text",this.value=""}getValue(){var t={};return t[this.name]=this.resultValue(),t}focus(){this.dom_element.focus()}setValue(t){this.vlaue=t}disabled(t){this.dom_element.disabled=t}readonly(t){this.dom_element.readonly=t}required(t){this.dom_element.required=t,this.required=t}}class UiStr extends UiType{static uitype="str";constructor(t){super(t),this.create("input"),this.sizable(),this.set_fontsize()}create(t){t=UiType.prototype._create.bind(this)(t);this.pattern=".*",t.type="text",t.id=t.name=this.opts.name,this.opts.readonly?t.readonly=!0:t.readonly=!1,this.opts.required&&(t.required=!0),this.opts.css?(t.classList.add(this.opts.css),this.actived_css=this.opts.css+"-actived"):(t.classList.add("input"),this.actived_css="input_actived"),t.value=parseInt(this.value),t.style.textAlign=this.opts.align||"left",this.opts.hasOwnProperty("length")&&(t.maxlength=this.opts.length),this.opts.hasOwnProperty("minlength")&&(t.minlength=this.opts.minlength),this.opts.hasOwnProperty("value")&&(this.value=this.opts.value),t.value=""+this.value,this.opts.defaultVlaue&&(t.defaultValue=this.opts.defaultValue),this.opts.tip&&(t.placeholder=bricks_app.i18n._(this.opts.tip)),t.addEventListener("focus",this.onfocus.bind(this)),t.addEventListener("blur",this.onblur.bind(this)),t.addEventListener("input",this.set_value_from_input.bind(this)),this.dom_element=t}onblur(t){this.dom_element.classList.remove(this.actived_css)}onfocus(t){this.dom_element.classList.add(this.actived_css)}check_pattern(t){var e=new RegExp(this.pattern),t=t.match(e);return t&&""!=t[0]?t[0]:null}set_value_from_input(t){var e,t=t.target;""==t.value?this.value="":"file"==t.type?this.value=t.value:null==(e=this.check_pattern(t.value))?t.value=this.value:(this.value=e,t=this.getValue(),this.dispatch("changed",t))}resultValue(){return this.value}setValue(t){this.value=t,this.dom_element.value=""+this.value}}class UiPassword extends UiStr{static uitype="password";constructor(t){super(t),this.dom_element.type="password"}}class UiInt extends UiStr{static uitype="int";constructor(t){super(t),this.dom_element.style.textAlign="right",this.dom_element.type="number",this.pattern="\\d*"}resultValue(){return parseInt(this.value)}setValue(t){this.value=""+t}}class UiFloat extends UiInt{static uitype="float";constructor(t){super(t),this.pattern="\\d*\\.?\\d+";for(var e=this.opts.dec_len||2,s=1,i=0;i<e;i++)s/=10;this.dom_element.step=s}resultValue(){return parseFloat(this.value)}setValue(t){this.value=""+t}}class UiTel extends UiStr{static uitype="tel";constructor(t){super(t),this.dom_element.type="tel",this.opts.pattern&&(this.dom_element.pattern=this.opts.pattern),this.pattern="[+]?\\d+"}}class UiEmail extends UiStr{static uitype="email";constructor(t){super(t),this.dom_element.type="email",this.opts.pattern&&(this.dom_element.pattern=this.opts.pattern),this.opts.pattern&&(this.dom_element.pattern=this.opts.pattern)}}class UiFile extends UiStr{static uitype="file";constructor(t){super(t),this.dom_element.type="file",this.opts.accept&&(this.dom_element.accept=this.opts.accept),this.opts.capture&&(this.dom_element.capture=this.opts.capture),this.opts.multiple&&(this.dom_element.multiple=!0)}}class UiCheck extends UiType{static uitype="check";constructor(t){super(t),UiCheck.prototype.update(Layout.prototype),this.add_widget=Layout.prototype.add_widget.bind(this),this.create("div"),this.dom_element.style.width="auto",this.dom_element.style.height="auto";var e="unchecked";t.value&&(e="checked"),this.ms_icon=new MultipleStateIcon({state:e,sources:{checked:bricks_resource("imgs/checkbox-checked.png"),unchecked:bricks_resource("imgs/checkbox-unchecked.png")}}),this.add_widget(this.ms_icon),this.ms_icon.bind("state_changed",this.set_value_from_input.bind(this))}set_value_from_input(t){var e="checked"==this.ms_icon.state,e=(this.value=e,{});e[this.name]=this.value,this.dispatch("changed",e)}setValue(t){(this.value=t)?this.ms_icon.set_state("checked"):this.ms_icon.set_state("unchecked")}resultValue(){return this.value}}class UiCheckBox extends UiType{static uitype="checkbox";constructor(t){super(t),this.valueField=t.valueField||"value",this.textField=t.textField||"text",this.value=this.opts.value||this.opts.defaultValue||[],Array.isArray(this.value)||(this.value=[this.value]),this.create("fieldset"),this.set_fontsize(),this.el_legend=this._create("legend");var e=this.opts.label||this.opts.name;this.el_legend.innerText=bricks_app.i18n._(e),this.opts.dataurl?schedule_once(this.load_data_onfly.bind(this),.01):(this.data=t.data,this.build_checkboxs())}build_checkboxs(){var t=this.data;this.input_boxs=[];for(var e=0;e<t.length;e++){var s=new HBox({height:"auto",width:"100%"}),i={},o=t[e][this.valueField],o=(this.value==o&&(i.value=!0),new UiCheck(i)),i=t[e][this.textField],i=new Text({otext:i,align:"left",i18n:!0});i.ht_left(),o.bind("changed",this.set_value_from_input.bind(this)),s.add_widget(o),s.add_widget(i),this.add_widget(s),this.input_boxs.push(o)}}async load_data_onfly(){var t=await jcall(this.opts.dataurl,{method:this.opts.method||"GET",params:this.opts.params});this.data=t,this.build_checkboxs()}set_value_from_input(t){t.stopPropagation();t=t.target,"checked"==t.state?this.value.push(t.value):this.value.remove(t.value),t={};t[this.name]=this.value,this.dispatch("changed",t)}resultValue(){return this.value}setValue(t){Array.isArray(t)?this.value=t:this.value=[t];for(var e=0;e<this.input_boxs.length;e++)(this.value=this.data[e][this.valueField])?this.input_boxs[e].set_state("checked"):this.input_boxs[e].set_state("unchecked")}}class UiDate extends UiStr{static uitype="date";constructor(t){super(t),this.opts_setup()}opts_setup(){var t=this.dom_element;t.type="date",this.opts.max_date&&(t.max=this.opts.max_date),this.opts.min_date&&(t.min=this.opts.min_date)}}class UiText extends UiType{static uitype="text";constructor(t){super(t),this.create("textarea"),this.set_fontsize(),this.build(),this.sizable(),this.set_fontsize()}build(){var t=this.dom_element;t.id=t.name=this.opts.name,t.rows=this.opts.rows||5,t.cols=this.opts.cols||40,t.innerText=this.opts.value||this.opts.defaultvalue||"",this.value=t.innerText,this.bind("input",this.set_value_from_input.bind(this))}set_value_from_input(t){this.value=this.dom_element.innerText}resultValue(){return this.value}}class UiCode extends UiType{static uitype="code";constructor(t){super(t),this.create("select"),this.data=this.opts.data,this.build()}build(){this.dom_element.id=this.opts.name,this.dom_element.name=this.opts.name,this.opts.dataurl?schedule_once(this.get_data.bind(this),.01):this.build_options(this.opts.data)}async get_data(t){var e=this.opts.params,t=(t&&e.update(t.params),await jcall(this.opts.dataurl,{method:this.opts.method||"GET",params:e}));this.data=t,this.build_options(t)}build_options(t){var e=this.dom_element,s=(e.replaceChildren(),this.opts.value||this.opts.defaultvalue);this.value=s,this.option_widgets={};for(var i=0;i<t.length;i++){var o=document.createElement("option");o.value=t[i][this.opts.valueField||"value"],o.innerText=bricks_app.i18n._(t[i][this.opts.textField||"text"]),(this.option_widgets[o.value]=o).value==s&&(o.selected=!0),e.appendChild(o),this.sizable_elements.push(o)}this.bind("input",this.set_value_from_input.bind(this)),this.sizable(),this.set_fontsize()}set_value_from_input(t){this.dom_element.innerText;for(var e=0;e<this.option_widgets.length;e++)this.option_widgets[e].checked&&(this.value=this.option_widgets[e].value)}resultValue(){return this.value}}class _Input{constructor(){this.uitypes=[]}register(t,e){e?e.uitype?(Factory.register(t,e),this.uitypes[e.uitype]=e):console.log("uitype of Klass not defined",t):console.log("Klass not defined",t)}factory(t){var e=this.uitypes.get(t.uitype);return e?(console.log("create input for:",t.uitype,"......",e),new e(t)):(console.log("create input for:",t.uitype,"failed"),null)}}var Input=new _Input;Input.register("UiStr",UiStr),Input.register("UiTel",UiTel),Input.register("UiDate",UiDate),Input.register("UiInt",UiInt),Input.register("UiFloat",UiFloat),Input.register("UiCheck",UiCheck),Input.register("UiCheckBox",UiCheckBox),Input.register("UiEmail",UiEmail),Input.register("UiFile",UiFile),Input.register("UiCode",UiCode),Input.register("UiText",UiText),Input.register("UiPassword",UiPassword);class RegisterFunction{constructor(){this.rfs={}}register(t,e){this.rfs.update({n:e})}get(t){return this.rfs.get(t)}}class Button extends Layout{constructor(t){super(t),this.create("button");t={display:"flex",justifyContent:"center",textAlign:"center",alignItem:"center",width:"auto",height:"auto",padding:"0.5rem"};"horizontal"==this.opts.orientation?(t.flexDirection="rows",this.orient="h"):(t.flexDirection="column",this.orient="v"),this.set_id(this.opts.nmae),this.opts_setup(),this.dom_element.style.update(t)}opts_setup(){this.opts.css&&this.set_css(this.opts.css);var t,e=this.opts.item_size||bricks_app.charsize;this.opts.icon&&(t=new Icon({url:this.opts.icon}),this.add_widget(t),t.bind("click",this.target_clicked.bind(this))),this.opts.text&&(t=new Text({height:e,width:0,otext:this.opts.text,fontsize:e,i18n:!0}),this.add_widget(t),t.bind("click",this.target_clicked.bind(this)))}target_clicked(t){console.log("target_clicked() .... called "),t.stopPropagation(),this.dispatch("click",this.opts)}}Factory.register("Button",Button);class Accordion extends VBox{constructor(t){super(t);for(var e=this.opts.item_size||"25px",s=(this.set_height("100%"),this.opts.items),i=(this.items=[],this.subcontents={},this.opts.css||"accordion-button"),o=(this.opts.css,0);o<s.length;o++){var t={height:e,item_size:e,name:s[o].name,icon:s[o].icon,text:s[o].text,orientation:"horizontal",css:i},a=new Button(t);a.set_height(e),a.bind("click",this.change_content.bind(this)),this.items.push(a),this.add_widget(a)}this.content=new VBox({})}async change_content(t){for(var e=event.params.name,s=-1,i=0;i<this.opts.items.length;i++)if(e==this.opts.items[i].name){s=i;break}var o=this.subcontents.get(e);o||(o=await widgetBuild(this.opts.items[s].content),this.subcontents[e]=o),this.content.clear_widgets(),this.content.add_widget(o);try{this.remove_widget(this.content)}catch(t){}this.add_widget(this.content,s+1)}}Factory.register("Accordion",Accordion);class TreeNode extends VBox{constructor(t,e,s){super(s),this.tree=t,this.parent=e,this.children_loaded=!1,this.data=s,this.is_leaf=this.data.is_leaf,this.params={id:this.data[this.tree.opts.idField]},this.tree.multitype_tree&&(this.params.type=this.data[this.tree.opts.typeField]);t=new HBox({height:"auto",width:"100%"});t.dom_element.style.margin=.2*bricks_app.charsize,this.add_widget(t),t.bind("click",this.tree.node_click_handle.bind(this.tree,this)),this.node_widget=t,this.create_node_content(t),this.data.is_leaf||(this.container=new VBox({}),this.container.dom_element.style.marginLeft=bricks_app.charsize,this.add_widget(this.container),this.container.hide(),this.data.children&&this.tree.create_node_children(this,this.data.children))}selected(t){t?this.str_w.dom_element.classList.add("selected"):this.str_w.dom_element.classList.remove("selected")}async toggleExpandCollapse(t){"open"==t.params?await this.expand():this.collapse()}async expand(){this.is_leaf||(!this.tree.opts.dataurl||this.is_leaf||this.children_loaded||(await this.tree.get_children_data(this),this.children_loaded=!0),this.container.show())}collapse(){this.is_leaf||this.container.hide()}create_node_content(t){var e=bricks_app.charsize,s=(this.is_leaf?t.add_widget(new BlankIcon({})):(s=this.tree.opts.node_state_imgs||{},(i={}).open=s.get("open",bricks_resource("imgs/down_arrow.png")),i.close=s.get("close",bricks_resource("imgs/right_arrow.png")),this.trigle=new MultipleStateIcon({state:"close",sources:i,height:e,width:e}),this.trigle.bind("state_changed",this.toggleExpandCollapse.bind(this)),t.add_widget(this.trigle)),this.data[this.tree.opts.typeField]),i=TypeIcons.get(s),e=(i=(i=!i&&this.tree.opts.default_type?TypeIcons.get(his.tree.opts.default_type):i)||bricks_resource("imgs/folder.png"),new Icon({source:i})),s=(t.add_widget(e),this.data[this.tree.opts.textField]);t.add_widget(this.str_w=new Text({text:s})),t.add_widget(this.str_w)}}class Tree extends VBox{constructor(t){super(t),this.create("div"),this.set_height("100%"),this.row_height=this.opts.row_height||"35px",this.multitype_tree=this.opts.multitype_tree||!1,this.selected_node=null,(this.container=this).data_id=null,this.opts.admin&&this.create_admin_toolbar(),this.opts.dataurl&&schedule_once(.01,this.get_children_data.bind(this,this)),this.create_node_children(this,this.opts.data)}async get_children_data(t){var e=await jcall(this.opts.dataurl,{method:this.opts.method||"GET",params:t.params});0==e.length?t.is_leaf=!0:this.create_tree_nodes(t,e)}create_node_children(t,e){for(var s=0;s<e.length;s++){var i=new TreeNode(this,t,e[s]);t.container.add_widget(i)}}node_click_handle(t,e){this.selected_node&&this.selected_node.selected(!1),(this.selected_node=t).selected(!0),this.dispatch("node_clicked",t)}}Factory.register("Tree",Tree);class MultipleStateImage extends Layout{constructor(t){super(t),this.state=this.opts.state,this.create("div");t={source:this.opts.sources[this.state],width:this.opts.width,height:this.opts.height};this.img=new Image(t),this.add_widget(this.img),this.img.bind("click",this.change_state.bind(this))}set_state(t){this.state=t,this.img.set_source(this.opts.sources[t])}change_state(t){t.stopPropagation();for(var e=Object.keys(this.opts.sources),s=0;s<e.length;s++)if(e[s]==this.state){var i=s+1;i>=e.length&&(i=0),this.state=e[i],this.img.set_source(this.opts.sources[this.state]),this.dispatch("state_changed",this.state);break}}}class MultipleStateIcon extends Icon{constructor(t){t.source=t.sources[t.state],super(t),this.state=t.state,this.sources=t.sources,this.bind("click",this.change_state.bind(this))}change_state(t){t.stopPropagation();for(var e=Object.keys(this.sources),s=0;s<e.length;s++)if(e[s]==this.state){var i=s+1;i>=e.length&&(i=0),this.set_state(e[i]),this.dispatch("state_changed",this.state);break}}set_state(t){this.state=t,this.set_source(this.sources[t])}}Factory.register("MultipleStateImage",MultipleStateImage);class Form extends VBox{constructor(t){super(t),this.name_inputs={},this.opts.title&&(t=new Title2({otext:this.opts.title,i18n:!0}),this.add_widget(t)),this.opts.description&&(t=new Text({otext:this.opts.description,i18n:!0}),this.add_widget(t)),this.form_body=new Layout({width:"100%"}),this.add_widget(this.form_body),this.form_body.set_css("multicolumns"),this.build_fields(this.opts.fields)}build_buttons(){}async validation(){var t,e={};for(t in this.name_inputs)if(this.name_inputs.hasOwnProperty(t)){var s=this.name_inputs[t],i=s.getValue();if(s.required&&(""==i[t]||null===i[t]))return console.log("data=",e,"d=",i),void s.focus();e.update(i)}await jcall(this.submit_url,{params:e})}build_fields(t){for(var e=0;e<t.length;e++){var s=new VBox({}),i=(s.set_css("inputbox"),this.form_body.add_widget(s),new Text({otext:t[e].label||t[e].name,i18n:!0})),i=(s.add_widget(i),Input.factory(t[e]));i?(s.add_widget(i),this.name_inputs[t[e].name]=i,console.log(t[e].uitype,"create Input ok")):console.log(t[e],"createInput failed")}}}Factory.register("Form",Form);class Message extends VBox{constructor(t){super(t),this.task=null,this.title=t.title||"Title",this.archor=t.archor||"cc",this.message=t.message,this.timeout=t.timeout,this.set_css("message"),this.build(),archorize(this.dom_element,this.archor),t.auto_open&&this.open()}build(){var t=new HBox({height:"40px"}),e=(t.set_css("title"),this.add_widget(t),new Text({otext:this.title,i18n:!0})),s=new VBox({}),t=(this.add_widget(s),t.add_widget(e),new Text({otext:this.message,i18n:!0}));s.add_widget(t)}open(){Body.add_widget(this),this.timeout&&0<this.timeout&&(this.task=schedule_once(this.dismiss.bind(this),this.timeout))}dismiss(){this.task&&(this.task.cancel(),this.task=null),Body.remove_widget(this)}}class Error extends Message{constructor(t){super(t),this.set_css("error")}}Factory.register("Message",Message),Factory.register("Error",Error);class BufferedDataLoader{constructor(t){this.url=t.url,this.method=t.method||"GET",this.params=t.params||{},this.buffer_pages=t.buffer_pages||5,this.pagerows=t.pagerows||60,this.cur_page=-1,this.buffer={},this.total_record=-1,this.cur_params={}}async loadData(t){this.cur_page=1,this.buffer={},t=t||{};var e=this.params.copy();return e.update(t),(this.cur_params=e).page=cur_page,e.rows=this.pagerows,this.loadPage()}async _loadPage(t){if(this.in_buffer(t))return buffer[t];this.cur_page=t;var e=this.cur_params.copy(),e=(e.page=this.cur_page,e.rows=this.pagerows,await jcall(this.url,{method:this.method,params:e}));return this.total_records=e.total,e.page=this.cur_page,e.total_page=this.total_records/this.pagerows,e.total_page*this.pagerows<this.total_record&&(e.total_page+=1),this.total_page=e.total_page,this.buffer[t]=e}async getPage(t){return this.cur_page=t,this.loadPage()}buffer_is_full(){var t=Object.keys(this.buffer);t.length>=this.buffer_pages&&(t="down"==this.direction?Math.min(t):Math.max(t),this.buffer[t])}async nextPage(){if(!(this.cur_page>=this.total_page))return this.direction="down",this.buffer_is_full(),this.cur_page+=1,this._loadPage()}async previousPage(){if(1!=this.cur_page)return this.direction="up",this.buffer_is_full(),this.cur_page+=1,this._loadPage()}}class HScrollPanel extends HBox{constructor(t){super(t);t={width:t.width||"100%",overflowX:"scroll"};this.set_cssObject(t),this.bind("scroll",this.scroll_handle.bind(this)),this.last_scrollLeft=this.dom_element.scrollLeft,this.threshold=!1}scroll_handle(t){t.stopPropagation(),console.log("scroll happend...");var t=this.dom_element,e=t.scrollWidth-t.clientWidth,e=t.scrollLeft/e,s=t.scrollLeft-this.last_scrollLeft;this.last_scrollLeft=t.scrollLeft,!this.threshold&&s<0&&e<=this.opts.min_threshold?(this.thresgold=!0,this.dispatch("min_threshold")):!this.threshold&&1<s&&e>=this.opts.max_threshold?(this.thresgold=!0,this.dispatch("max_threshold")):this.threshold=!1}}class VScrollPanel extends VBox{constructor(t){super(t);t={height:t.height||"100%",overflowY:"scroll"};this.set_cssObject(t),this.bind("scroll",this.scroll_handle.bind(this)),this.last_scrollTop=this.dom_element.scrollTop,this.threshold=!1}scroll_handle(t){t.stopPropagation(),console.log("scroll happend...");var t=this.dom_element,e=t.scrollHeight-t.clientHeight,e=t.scrollTop/e,s=t.scrollTop-this.last_scrollTop;this.last_scrollTop=t.scrollTop,!this.threshold&&s<0&&e<=this.opts.min_threshold?(this.thresgold=!0,this.dispatch("min_threshold")):!this.threshold&&1<s&&e>=this.opts.max_threshold?(this.thresgold=!0,this.dispatch("max_threshold")):this.threshold=!1}}
