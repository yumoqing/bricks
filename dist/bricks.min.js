var currentScriptPath=function(){var t,e=(t=document.currentScript||(t=document.querySelectorAll("script[src]"))[t.length-1].src).split("/"),e=e[e.length-1];return t.replace(e,"")};function querySelectorAllShadows(e,t=document.body){var s=Array.from(t.querySelectorAll("*")).map(t=>t.shadowRoot).filter(Boolean),s=(console.log("[querySelectorAllShadows]",e,t,`(${s.length} shadowRoots)`),s.map(t=>querySelectorAllShadows(e,t)));return Array.from(t.querySelectorAll(e)).concat(s).flat()}var schedule_once=function(t,e){e*=1e3,window.setTimeout(t,e)},schedule_interval=function(s,t){schedule_once(function(t,e){t(),schedule_once(s,e)}.bind(s,t),t)},debug=function(){console.log(...arguments)},import_cache=new Map,import_css=async function(t){var e,s;1!==import_cache.get(t)&&(e=await tget(t),debug("import_css():tget() return",e),(s=document.createElement("style")).setAttribute("type","text/javascript"),s.innerHTML=e,document.getElementsByTagName("head")[0].appendChild(s),import_cache.set(t,1))},import_js=async function(t){var e;1!==import_cache.get(t)&&((e=document.createElement("script")).setAttribute("type","text/javascript"),e.src=t,document.body.appendChild(e),import_cache.set(t,1))},extend=function(t,e){for(var s in e)e.hasOwnProperty(s)&&(t[s]&&"object"==typeof t[s]&&"[object Object]"==t[s].toString()&&e[s]?extend(t[s],e[s]):t[s]=e[s]);return t},get=function(t,e,s){return t.hasOwnProperty(e)?t[e]:s},obj_fmtstr=function(i,t){return t.replace(/\${(\w+)([:=]*)}/g,(t,e,s)=>i.hasOwnProperty(e)?""==s?i[e]:e+s+i[e]:"")},archorize=(Object.prototype.fmtstr=function(t){return obj_fmtstr(this,t)},Object.prototype.update=function(t){extend(this,t)},function(t,e){var s=(e=e||"cc")[0],e=e[1],i="0%";switch(s){case"t":i="0%";break;case"b":i="100%";break;default:i="50%"}var o="0%";switch(e){case"l":o="0%";break;case"r":o="100%";break;default:o="50%"}t.style.top=i;s={x:t.style.left=o,y:i}.fmtstr("translateY(-${y}) translateX(-${x})");console.log("archorize(): tsf=",s),t.style.transform=s,t.style.position="absolute"});Array.prototype.remove=function(t){t=this.indexOf(t);return 0<=t&&this.splice(t,1),this};class I18n{constructor(){this.msgs={},console.log("I18n():msg=",this.msgs)}_(t){return this.msgs.hasOwnProperty(t)?this.msgs[t]:t}}class Factory_{constructor(){this.widgets_kv=new Object,this.widgets_kv._t_=1,console.log("kv=",this.widgets_kv)}register(t,e){this.widgets_kv[t]=e}get(t){return this.widgets_kv.hasOwnProperty(t)?this.widgets_kv[t]:null}}const Factory=new Factory_;class JsWidget{dom_element=null;constructor(t){this.opts=t,this._container=!1,this.parent=null}h_center(){this.dom_element.style.marginLeft="auto",this.dom_element.style.marginRight="auto"}h_left(){this.dom_element.style.marginLeft="0px",this.dom_element.style.marginRight="auto"}h_right(){this.dom_element.style.marginLeft="auto",this.dom_element.style.marginRight="0px"}ht_center(){this.dom_element.style.textAlign="center"}ht_left(){this.dom_element.style.textAlign="left"}ht_right(){this.dom_element.style.textAlign="right"}set_width(t){this.dom_element.style.width=t}set_height(t){this.dom_element.style.height=t}set_css(t){this.dom_element.classList.add(t)}is_container(){return this._container}create(t){this.dom_element=document.createElement(t),this.dom_element.bricks_widget=this}_create(t){return document.createElement(t)}set_id(t){this.dom_element.id=t}set_baseURL(t){this.baseURL=t}show(){this.dom_element.style.display=""}hide(){this.dom_element.style.display="none"}bind(t,e){this.dom_element.addEventListener(t,e)}unbind(t,e){this.dom_element.removeEventListener(t,e)}dispatch(t,e){t=new Event(t);t.params=e,this.dom_element.dispatchEvent(t)}}class TextBase extends JsWidget{constructor(t){super(t),this.opts=t,this.specified_fontsize=!1,this.create("div"),this.set_attrs(),bricks_app.text_ref(this)}change_textsize(t){this.specified_fontsize&&(this.dom_element.style.fontSize=fontsize)}set_fontsize(){var t=this.opts.fontsize?(this.specified_fontsize=!0,this.opts.fontsize):bricks_app.get_textsize(this.ctype);this.dom_element.style.fontSize=t,"text"!=this.ctype?this.dom_element.style.fontWeight="bold":this.dom_element.style.fontWeight="normal"}set_attrs(){this.opts.hasOwnProperty("text")&&(this.text=this.opts.text),this.opts.hasOwnProperty("otext")&&(this.otext=this.opts.otext,console.log("otext=",this.opts.otext,this.otext)),this.opts.hasOwnProperty("i18n")&&(this.i18n=this.opts.i18n),this._i18n=new I18n,this.i18n&&this.otext&&(this.text=this._i18n._(this.otext),console.log("otext=",this.otext,"text=",this.text)),this.dom_element.innerHTML=this.text,this.set_fontsize()}set_i18n_text(){this.otext&&this.i18n&&(this.text=this._i18n._(this.otext),this.dom_element.innerHTML=this.text)}}class Text extends TextBase{constructor(t){super(t),this.ctype="text",this.set_fontsize()}}class Title1 extends TextBase{constructor(t){super(t),this.ctype="title1",this.set_fontsize()}}class Title2 extends TextBase{constructor(t){super(t),this.ctype="title2",this.set_fontsize()}}class Title3 extends TextBase{constructor(t){super(t),this.ctype="title3",this.set_fontsize()}}class Title4 extends TextBase{constructor(t){super(t),this.ctype="title4",this.set_fontsize()}}class Title5 extends TextBase{constructor(t){super(t),this.ctype="title5",this.set_fontsize()}}class Title6 extends TextBase{constructor(t){super(t),this.ctype="title6",this.set_fontsize()}}Factory.register("Text",Text),Factory.register("Title1",Title1),Factory.register("Title2",Title2),Factory.register("Title3",Title3),Factory.register("Title4",Title4),Factory.register("Title5",Title5),Factory.register("Title6",Title6);let bricks_app=null;class Bricks{async widgetBuild(e){"urlwidget"===e.widgettype&&(i=e.options.url,t=e.options.method||"GET",s=e.options.params||{},e=await jcall(i,{method:t,params:s}));var t,s,i=Factory.get(e.widgettype);if(!i)return console.log("widgetBuild():",e.widgettype,"not registered"),null;var o=new i(e.options);if(e.hasOwnProperty("id")&&o.set_id(e.id),e.hasOwnProperty("subwidgets"))for(let t=0;t<e.subwidgets.length;t++){var n=e.subwidgets[t],a=await this.widgetBuild(n);a?o.add_widget(a):console.log("widgetBuild() error: sdesc=",n)}if(e.hasOwnProperty("binds"))for(var r=0;r<e.binds.length;r++)this.buildBind(o,e.binds[r]);return console.log("w=",o),o}buildBind(t,e){var s,i=this.getWidgetById(e.wid,t),t=this.buildEventHandler(t,e);t?(e.conform&&((s=this.widgetBuild(e.conform)).bind("on_conform",t),t=s.open.bind(s)),i.bind(e.event,t)):console.log("buildBind(): handler is null",e)}buildEventHandler(t,e){var s=this.getWidgetById(e.target,t);if(!s)return console.log("target miss",e),null;var i,o=null;switch(e.datawidget&&(i={widget:e.datawidget,method:e.datamethod,params:e.dataparams,script:e.datascript},o=this.getRealtimeData(i)),e.actiontype){case"bricks":return this.buildBricksHandler(t,s,o,e);case"registerfunction":return this.buildRegisterFunction(t,s,o,e);case"method":return this.buildMethodHandler(t,s,o,e);case"script":console.log("buildEventHandler():here");var n=this.buildScriptHandler(t,s,o,e);return console.log("buildEventHandler():here1--",n),n;case"event":return this.buildDispatchEventHandler(t,s,o,e);default:console.log("invalid actiontype",s,e)}}buildBrickHandler(t,e,s,i){var o={};return o.update(i.options),(o.params||s)&&o.update(o.params.update(s)),function(t,e,s){s=(new Bricks).widgetBuild(s);"replace"==e&&t.clear_widgets(),t.add_widget(s)}.bind(e,i.mode||"replace",o)}buildRegisterFunctionHandler(t,e,s,i){var o=registerfunctions.get(i.rfname),i=(o||console.log("rfname:",i.rfname,"not registed",i),i.params||{});return s&&i.update(s),o.bind(e,i)}buildMethodHandler(t,e,s,i){var o=e[i.method],i=i.params||{};return s&&i.update(s),o.bind(e,i)}buildScriptHandler(t,e,s,i){var o=i.params||{};return s&&o.update(s),new Function("target","params","event",i.script).bind(e,o)}buildDispatchEventHandler(t,e,s,i){i=i.params||{};s&&i.update(s);return function(t,e,s){t.dispatch(e,s)}.bind(e,i)}getWidgetById(e,t){if(!e)return t;for(var s,i=e.split("/"),o=t.dom_element,n=0,a=0;a<i.length;a++){if(0==n){if(n=1,"self"==i[a]){o=t.dom_element;continue}if("root"==i[a]){o=bricks_app.root.dom_element;continue}if("app"==i[a])return bricks_app;if("window"==i[a]){o=Body.dom_element;continue}}try{o="-"==i[a][0]?(s=substr(1,i[a].length-1),o.closest("#"+s)):o.querySelector("#"+i[a])}catch(t){return console.log("getWidgetById():i=",i[a],e,"not found",t),null}if(null==o)return console.log("getWidgetById():",e,o),null}return void 0!==o.bricks_widget?(console.log("getWidgetById():",e,o,"widget"),o.bricks_widget):(console.log("getWidgetById():",e,o),o)}}class BricksApp{constructor(t){this.opts=t,(bricks_app=this).charsize=this.opts.charsize||20,this.opts.language?this.lang=this.opts.language:this.lang=navigator.language,this.textList=[],this.i18n=new I18n,schedule_once(this.build.bind(this),.01)}get_textsize(t){var e=this.charsize;return parseInt({text:1,title1:1.96,title2:1.8,title3:1.64,title4:1.48,title5:1.32,title6:1.16}[t]*e)+"px"}text_ref(t){this.textList.push(new WeakRef(t))}text_remove_dead(){for(var t=this.textList,e=0;e<t.length;e++)t[e].deref()||this.textList.remove(t[e])}async setup_i18n(){var t={lang:this.lang};d=await jcall(desc.url,{method:desc.method||"GET",params:t}),this.i18n.setup_dict(d)}async build(){console.log("App.build() called ... ");var t=new Bricks,e=structuredClone(this.opts.widget);return await t.widgetBuild(e)}async run(){console.log("App.run() called ... "),this.opts.i18n&&this.setup_i18n(),console.log("before ..........................");var t=await this.build();console.log("after  .........................."),this.root=t,Body.add_widget(t)}text_resize=function(){for(var t=this.textList,e=0;e<t.length;e++)t[e].deref()||(w=t[e].deref(),ts=this.get_textsize(ctype),w.change_fontsize(ts))};change_language=async function(t){this.lang=t,await this.setup_i18n();for(var e=this.textList,s=0;s<e.length;s++)e[s].deref()||(w=e[s].deref()).opts.i18n&&w.set_i18n_text()}}class Image extends JsWidget{constructor(t){super(),this.opts=t,this.create("img"),this.options_parse()}options_parse(){this.opts.hasOwnProperty("source")&&(this.source=this.opts.source,this.dom_element.src=this.source),this.opts.hasOwnProperty("width")&&(this.width=this.opts.width,this.dom_element.style.width=this.width),this.opts.hasOwnProperty("height")&&(this.height=this.opts.height,this.dom_element.style.height=this.height)}}function url_params(e){return Object.keys(e).map(t=>t+"="+encodeURIComponent(e[t])).join("&")}Factory.register("Image",Image);class HttpText{constructor(t){this.headers=(t=t||{})||{Accept:"text/html"},this.headers.update(t),this.params={_webbricks_:1}}async get_result_data(t){return t.text()}add_own_params(t){if((t=t||{})instanceof FormData)for(var[e,s]of Object.entries(this.params))t.append(e,s);else t=Object.assign(this.params,t);return t}add_own_headers(t){return t=t||{},Object.assign(this.headers,t)}async httpcall(t,{method:e="GET",headers:s=null,params:i=null}={}){var o=this.add_own_params(i),s=(this.add_own_headers(s),{method:e}),o=("GET"==e||"HEAD"==e?t=t+"?"+url_params(o):o instanceof FormData?s.body=o:s.body=JSON.stringify(o),await fetch(t,s)),s=await this.get_result_data(o);if(o.ok)return console.log("method=",e,"url=",t,"params=",i),console.log("result=",s),s;console.log("method=",e,"url=",t,"params=",i),console.log("jsoncall error:");o={type:"Error",message:s.message||"Something went wrong",data:s.data||"",code:s.code||""},e=new Error;return e.info=o,e}async get(t,{headers:e=null,params:s=null}={}){return this.httpcall(t,{method:"GET",headers:e,params:s})}async post(t,{headers:e=null,params:s=null}={}){return this.httpcall(t,{method:"POST",headers:e,params:s})}}class HttpJson extends HttpText{constructor(t){super(t=t||{}),this.headers={Accept:"application/json"},this.headers.update(t)}async get_result_data(t){return t.json()}}var hc=new HttpText,tget=hc.get.bind(hc),tpost=hc.post.bind(hc),jcall=(jc=new HttpJson).httpcall.bind(jc),jget=jc.get.bind(jc),jpost=jc.post.bind(jc);class Oper{constructor(t){this.value=t}__plus__(t,e){return console.log(t,e),new Oper(t.value+e.value)}__add__(t,e){return console.log(t,e),new Oper(t.value+e.value)}}class Layout extends JsWidget{constructor(t){super(t),this._container=!0,this.children=[],this.create("div"),console.log("this=",this)}opts_handle(){var t=this.dom_element;this.opts.width&&(t.style.width=this.opts.width),this.opts.height&&(t.style.height=this.opts.height),this.opts.css&&this.dom_element.classList.add(this.opts.css)}add_widget(t,e){(t.parent=this).children.push(t),this.dom_element.appendChild(t.dom_element)}remove_widget(e){e.parent=null,this.children=this.children.filter(function(t){return t!==e}),this.dom_element.removeChild(e.dom_element)}clear_widgets(t){for(var e=0;e<this.children.length;e++)this.children[e].parent=null;this.children=[],this.dom_element.replaceChildren()}}class _Body extends Layout{constructor(t){super(t),this.dom_element=document.getElementsByTagName("body")[0]}}Body=new _Body;class BoxLayout extends Layout{constructor(t){super(t),this.create("div"),this.opts_handle(),this.container_jss={display:"flex"},this.child_jss={},this.orientation=get(t,"orientation","vertical"),this.orientation in["vertical","horizontal"]&&(this.orientation="vertical")}}class VBox extends BoxLayout{constructor(t){super(t),this.orientation="vertical",this.container_jss.flexFlow="column",this.dom_element.style.update(this.container_jss)}add_widget(t,e){var s=t.dom_element;BoxLayout.prototype.add_widget.call(this,t,e),t.opts.height?s.style.flex=obj_fmtstr({height:t.opts.height},"0 1 ${height}"):s.style.flex="1 1 auto"}}class HBox extends BoxLayout{constructor(t){super(t),this.orientation="horizontal",this.container_jss.flexFlow="row",this.dom_element.style.update(this.container_jss)}add_widget(t,e){var s=t.dom_element;BoxLayout.prototype.add_widget.call(this,t,e),t.opts.width?s.style.flex=obj_fmtstr({width:t.opts.width},"0 1 ${width}"):s.style.flex="1 1 auto"}}Factory.register("HBox",HBox),Factory.register("VBox",VBox);class Menu extends VBox{constructor(t){super(t),this.create("div"),this.dom_element.style.display="",this.dom_element.style.position="absolute",this.dom_element.style.backgroundColor=t.bgcolor||"white",this.dom_element.style.zIndex="1000",this.create_children(this.dom_element,this.opts.items),this.bind("click",this.menu_clicked)}create_submenu_container(){var t=document.createElement("div");return t.style.marginLeft="15px",t.style.display="none",t}async menu_clicked(t){var e=t.target;if(0<e.children.length)for(var s=0;s<e.children.length;s++)"none"==e.children[s].style.display?e.children[s].style.display="":e.children[s].style.display="none";else console.log("item clicked")}create_children(e,s){console.log("create_children():items=",s,"p=",e);for(let t=0;t<s.length;t++){var i,o=s[t],n=this.create_menuitem(o);e.appendChild(n),o.hasOwnProperty("items")&&(i=this.create_submenu_container(),n.appendChild(i),this.create_children(i,o.items))}}create_menuitem(t){var e=bricks_app.i18n,s=(console.log("i18n=",e),document.createElement("div"));return s.textContent=e._(t.label||t.name),console.log("create_menuitem():item=",t,"obj=",s),s}}Factory.register("Menu",Menu);class Modal extends JsWidget{constructor(t){super(t),this.create()}create(){var t=document.createElement("div"),e=(t.style.display="none",t.style.position="fixed",t.style.zIndex=get(this.opts,"org_index",0)+1,t.style.paddingTop="100px",t.style.left=0,t.style.top=0,t.style.width="100%",t.style.height="100%",t.style.backgroundColor=get(this.opts,"bgcolor","rgba(0,0,0,0.4)"),this.dom_element=t,document.createElement("div")),t=(e.style.position="absolute",e.style.backgroundColor="rgb(1,0,0)",e.style.width=get(this.opts,"width","70%"),e.style.height=get(this.opts,"height","70%"),t.appendChild(e),document.createElement("div")),s=(t.style.color="#aaaaaa",t.style.float="right",t.style.fontSize="28px",t.style.fontWeight="bold",t.my_modal=this,t.innerHTML="&times;",t.onclick=function(t){t.target.my_modal.dismiss()},document.createElement("div")),t=(s.style.height="40px",s.style.width="100%",this.opts.titleCSS&&s.classList.add(this.opts.titleCSS),this.opts.title&&s.appendChild(Title3({otext:this.opts.title,i18n:!0})),s.appendChild(t),e.appendChild(s),document.createElement("div"));t.style.overflow="auto",t.style.width="100%",t.style.height="100%",t.style.backgroundColor="rgb(0, 255, 0)",this.opts.contentCSS&&t.classList.add(this.opts.contentCSS),e.appendChild(t),archorize(e,get(this.opts,"archor","cc")),this.content=t,(this.dom_element.bricks_widget=this).content.bricks_widget=this}add_widget(t,e){console.log("add_widget():w=",t),e&&this.content.children.length>e?this.content.insertBefore(t.dom_element,this,content.children[e]):this.content.appendChild(t.dom_element),this.opts.auto_open&&this.open()}click_handler(t){console.log("click_handler() called ..."),t.target==this.dom_element?this.dismiss():console.log("modal():click_handler()")}open(){var t;console.log("modal():open called ............"),this.opts.auto_close&&(t=this.click_handler.bind(this),window.addEventListener("click",t)),this.dom_element.style.display=""}dismiss(){this.dom_element.style.display="none",this.opts.auto_close&&window.removeEventListener("click",this.click_handler)}}Factory.register("Modal",Modal);class MdText extends JsWidget{constructor(t){super(t),this.create("div");t=this.build.bind(this);this.load_event=new Event("loaded"),schedule_once(t,.01)}build=async function(){this._build(this.opts.md_url)};_build=async function(t){for(var e=await tget(t),s=(this.dom_element.innerHTML=marked.parse(e),this.dom_element.getElementsByTagName("a")),i=0;i<s.length;i++){var o=s[i].href;s[i].href="#",s[i].onclick=this._build.bind(this,o)}this.dispatch("loaded",{url:t})}}class MarkdownViewer extends VBox{constructor(t){super(t),this.create("div"),this.back_stack=[],this.opts.navigator&&this.createBackButton(),this.mdtext=new MdText({md_url:this.opts.md_url}),this.add_widget(this.mdtext),this.mdtext.bind("loaded",this.add_back_stack.bind(this))}createBackButton=async function(){var t={widgettype:"HBox",options:{},subwidgets:[{widgettype:"Text",options:{text:"<<<<<<<"}}]},e=await(new Bricks).widgetBuild(t),s=(console.log("createBackButton():error, desc=",t,"w=",e),e.children[0]);console.log("createBackButton():text=",s),s.bind("click",this.go_back.bind(this)),this.add_widget(e),console.log("createBackButton():desc=",t,"w=",e)};add_back_stack(t){console.log("go_back_stack():event=",t);t=t.params.url;this.back_stack.push(t)}go_back=async function(t){var e;this.back_stack.length<2||(this.back_stack.pop(),e=this.back_stack.pop(),await this.mdtext._build(e))};build=async function(){this._build(this.opts.md_url)};_build=async function(t){for(var t=await tget(t),e=(this.md_el.innerHTML=marked.parse(t),this.md_el.getElementsByTagName("a")),s=0;s<e.length;s++){var i=e[s].href;e[s].href="#",e[s].onclick=this._build.bind(this,i)}}}Factory.register("MarkdownViewer",MarkdownViewer);class Video extends JsWidget{constructor(t){super(t),this.create("video"),this.dom_element.controls=!0,this.opts.url&&(this.dom_element.src=this.opts.url)}}class VideoPlayer extends VBox{constructor(t){super(t),this.create("div");var t="",e=(this.opts.autoplay&&(t="autoplay"),this.opts.url);this.dom_element.innerHTML=`<video width="100%" controls ${t} > 		<source src=${e} /> 		</video>`}}Factory.register("VideoPlayer",VideoPlayer);class AudioPlayer extends JsWidget{constructor(t){super(t),this.create("div"),this.audio=this._create("audio"),this.audio.controls=!0,this.opts.autoplay&&this.audio.addEventListener("canplay",this.play_audio.bind(this)),this.audio.style.width="100%";t=this._create("source");t.src=this.opts.url,this.audio.appendChild(t),this.dom_element.appendChild(this.audio)}play_audio(){var t=querySelectorAllShadows(".play-pause",this.audio);0<t.length&&(t[0].click(),console.log("AudioPlayer():playing ...")),console.log("AudioPlayer():play button not found")}}Factory.register("AudioPlayer",AudioPlayer);class Toolbar extends BoxLayout{constructor(t){super(t),this.create("div"),this.toolList=[],"vertical"==this.opts.orientation?(this.bar=new VBox(t),this.dom_element.classList.add("vtoolbar")):(this.bar=new HBox(t),this.dom_element.classList.add("htoolbar")),this.add_widget(this.bar),this.preffix_css=this.opts.css||"toolbar",schedule_once(this.createTools.bind(this),.01)}createTools=async function(){for(var t=0;t<this.opts.tools.length;t++)await this.createTool(this.opts.tools[t]);this.dispatch("ready")};createTool=async function(t){var e={widgettype:"HBox",options:{},subwidgets:[]};t.icon&&e.subwidgets.push({widgettype:"Image",options:{source:t.icon}}),e.subwidgets.push({widgettype:"Text",options:{otext:t.label||t.name,i18n:!0}});var s=await(new Bricks).widgetBuild(e);if(s)return console.log("Toolbar():createTool(): w = ",s),s.dom_element.classList.add(this.preffix_css+"-button"),s.bind("click",this.do_handle.bind(this,s)),s.tool_opts=t,this.add_removable(s),this.toolList.push(s),this.bar.add_widget(s),s;console.log("Toolbar(): build widget failed",e)};remove_item(t,e){this.bar.remove_widget(t),this.toolList.remove(t),t.unbind("click",this.do_handle.bind(this,t)),this.dispatch("remove",t.tool_opts),e.preventDefault(),e.stopPropagation()}do_handle(t,e){console.log("Toolbar() onclock,target=",e.target,t);new Event("command");e={};e.update(t.tool_opts),this.opts.target&&(e.target=this.opts.target),this.dispatch("command",e);for(var s=0;s<this.toolList.length;s++)this.toolList[s].dom_element.classList.remove(this.preffix_css+"-button-active");t.dom_element.classList.add(this.preffix_css+"-button-active")}add_removable(t){var e,s;t.tool_opts.removable&&(s={source:e=currentScriptPath()+"imgs/delete.png",width:"24px",heigh:"24px"},(s=new Image(s))?(t.add_widget(s),s.bind("click",this.remove_item.bind(this,t)),console.log("Toolbar(): add_removable() for ",e)):console.log("Toolbar(): Image create error",e))}click(t){for(var e=0;e<this.toolList.length;e++)t==this.toolList[e].tool_opts.name&&this.toolList[e].dom_element.click()}}Factory.register("Toolbar",Toolbar);class TabPanel extends Layout{constructor(t){super(t),this.content_buffer={},this.cur_tab_name="",this.content_container=new VBox({}),this.dom_element.style.width="100%",this.dom_element.style.height="100%","top"==this.opts.tab_pos||"bottom"==this.opts.tab_pos?(this.panel=new VBox({}),t=this.opts.tab_wide||"45px",this.tab_container=new VBox({height:t}),this.tab_container.dom_element.style.width=this.opts.tab_long||"100%"):(this.panel=new HBox({}),t=this.opts.tab_wide||"70px",this.tab_container=new VBox({width:t}),this.tab_container.dom_element.style.height=this.opts.tab_long||"100%"),"top"==this.opts.tab_pos||"left"==this.opts.tab_pos?(this.panel.add_widget(this.tab_container),this.panel.add_widget(this.content_container)):(this.panel.add_widget(this.content_container),this.panel.add_widget(this.tab_container)),this.panel.dom_element.style.width="100%",this.panel.dom_element.style.height="100%",this.add_widget(this.panel),this.createToolbar(),this.panel.dom_element.classList.add("tabpanel"),this.content_container.dom_element.classList.add("tabpanel-content")}show_first_tab(){this.show_content_by_tab_name(this.opts.items[0].name)}show_content_by_tab_name(t){this.toolbar.click(t)}createToolbar(){var t={tools:this.opts.items},e="top"==this.opts.tab_pos||"bottom"==this.opts.tab_pos?"horizontal":"vertical";t.orientation=e,this.toolbar=new Toolbar(t),this.toolbar.bind("command",this.show_tabcontent.bind(this)),this.toolbar.bind("remove",this.tab_removed.bind(this)),this.toolbar.bind("ready",this.show_first_tab.bind(this)),this.tab_container.add_widget(this.toolbar)}show_tabcontent=async function(t){var e=t.params,s=this.opts.items;if(e.name==this.cur_tab_name)console.log("TabPanel(): click duplication click on same tab",e);else{for(var i,o=0;o<s.length;o++)if(e.name==s[o].name)return(i=get(this.content_buffer,e.name))&&!s[o].refresh?(this.content_container.clear_widgets(),this.content_container.add_widget(i),void(this.cur_tab_name=name)):(i=await(new Bricks).widgetBuild(s[o].content))?(this.content_buffer[e.name]=i,this.content_container.clear_widgets(),this.content_container.add_widget(i),void(this.cur_tab_name=e.name)):void console.log("TabPanel():create content error",s[o].content);console.log("TabPanel(): click event handled but noting to do",e)}};add_tab(t){var e=this.toolbar.createTool(t);t.removable&&this.add_removeable(e)}tab_removed(t){t=t.params;this.content_buffer.hasOwnProperty(t.name)&&delete this.content_buffer[t.name],t.name==this.cur_tab_name&&this.show_first_tab()}}Factory.register("TabPanel",TabPanel);class UtType extends JsWidget{constructor(t){super(t),this.name=t.name,this.value=""}getValue(){var t={};return t[this.name]=this.value,t}setValue(t){this.vlaue=t}disabled(t){this.dom_element.disabled=t}readonly(t){this.dom_element.readonly=t}required(t){this.dom_element.required=t}}class UtStr extends UtType{static uitype="str";constructor(t){super(t),this.create("input")}create(t){t=UtType.prototype._create.bind(this)(t);t.type="text",t.id=t.name=this.opts.name,this.opts.readonly?t.readonly=!0:t.readonly=!1,this.opts.required&&(t.required=!0),this.opts.css?(t.classList.add(this.opts.css),this.actived_css=this.opts.css+"-actived"):(t.classList.add("input"),this.actived_css="input_actived"),t.value=parseInt(this.value),t.style.textAlign=this.opts.align||"left",this.opts.hasOwnProperty("length")&&(t.maxlength=this.opts.length),this.opts.hasOwnProperty("minlength")&&(t.minlength=this.opts.minlength),this.opts.hasOwnProperty("value")&&(this.value=this.opts.value),t.value=""+this.value,this.opts.defaultVlaue&&(t.defaultValue=this.opts.defaultValue),this.opts.tip&&(t.placeholder=bricks_app.i18n._(this.opts.tip)),t.addEventListener("focus",this.onfocus.bind(this)),t.addEventListener("blur",this.onblur.bind(this)),t.addEventListener("change",this.set_value_from_input.bind(this)),this.dom_element=t}onblur(t){this.dom_element.classList.remove(this.actived_css)}onfocus(t){this.dom_element.classList.add(this.actived_css)}set_value_from_input(t){t=t.target,this.value=t.value,t={};t[this.name]=this.value,this.dispatch("changed",t)}setValue(t){this.value=t,this.dom_element.value=""+this.value}}class UtInt extends UtStr{static uitype="int";constructor(t){super(),el.style.textAlign="right",this.dom_element.type="number"}getValue(){var t=new Object;return t[this.name]=parseInt(this.value),t}setValue(t){this.value=""+t}}class UtFloat extends UtInt{static uitype="float";constructor(t){super();for(var e=this.opts.dec_len||2,s=1,i=0;i<e;i++)s/=10;this.dom_element.step=s}getValue(){var t=new Object;return t[this.name]=parseFloat(this.value),t}setValue(t){this.value=""+t}}class UtTel extends UtStr{static uitype="tel";constructor(t){super(t),this.dom_element.type="tel",this.opts.pattern&&(this.dom_element.pattern=this.opts.pattern)}}class UtEmail extends UtStr{static uitype="email";constructor(t){super(t),this.dom_element.type="email",this.opts.pattern&&(this.dom_element.pattern=this.opts.pattern),this.opts.pattern&&(this.dom_element.pattern=this.opts.pattern)}}class UtFile extends UtStr{static uitype="file";constructor(t){super(t),this.dom_element.type="file",this.opts.accept&&(this.dom_element.accept=this.opts.accept),this.opts.capture&&(this.dom_element.capture=this.opts.capture),this.opts.multiple&&(this.dom_element.multiple=!0)}}class UtCheckBox extends UtStr{static uitype="checkbox";constructor(t){super(t),this.create("fieldset"),this.el_legend=this._create("legend");t=this.opts.label||this.opts.name;this.el_legend.innerTEXT=bricks_app.i18n._(t),this.opts.dataurl?schedule_once(this.load_data_onfly.bind(this),.01):build_checkboxs(this.opts.data)}build_checkboxs(t){this.input_boxs=[],this.value=this.opts.value||this.opts.defaultValue||[],Array.isArray(this.value)||(this.value=[this.value]);for(var e=0;e<t.length;e++){var s=this._create("div"),i=(this.dom_element.appendChild(s),this._create("input")),o=(i.type="checkbox",i.id=this.opts.name+e,i.name=his.opts.name,i.value=t[e][this.opts.valueField||"value"],0<=this.value.indexOf(i.value)&&(i.checked=!0),i.addEventListener("change",this.set_value_from_input.bind(this)),s.appendChild(i),this._create("label"));o.innerHTML=bricks_app.i18n._(t[e][this.opts.textField||"text"]),o.for=i.id,s.appendChild(o),this.input_boxs.push(i),s.appendChild(o)}}async load_data_onfly(){var t=await jcall(this.opts.dataurl,{method:this.opts.method||"GET",params:this.opts.params});this.build_checkboxs(t)}set_value_from_input(t){t=t.target,t.checked?this.value.push(t.value):this.value.remove(t.value),t={};t[this.name]=this.value,this.dispatch("changed",t)}getValue(t){var e={};return e[this.name]=this.value,e}setValue(t){Array.isArray(t)?this.value=t:this.value=[t];for(var e=0;e<this.input_boxs.length;e++)0<=this.value.indexOf(this.input_boxs[e].value)&&(this.input_boxs[e].checked=!0)}}class UtDate extends UtStr{static uitype="date";constructor(t){super(t),this.opts_setup()}opts_setup(){var t=this.dom_element;t.type="date",this.opts.max_date&&(t.max=this.opts.max_date),this.opts.min_date&&(t.min=this.opts.min_date)}}class _Input{constructor(){this.uitypes=[]}register(t,e){e?e.uitype?(console.log("uitype=",e.uitype,"name=",t),Factory.register(t,e),this.uitypes[e.uitype]=e):console.log("uitype of Klass not defined",t):console.log("Klass not defined",t)}factory(t,e){t=get(this.uitypes,t);return t?new t(e):null}}var Input=new _Input;Input.register("UtStr",UtStr),Input.register("UtTel",UtTel),Input.register("UtDate",UtDate),Input.register("UtInt",UtInt),Input.register("UtFloat",UtFloat),Input.register("UtCheckBox",UtCheckBox),Input.register("UtDate",UtDate),Input.register("UtEmail",UtEmail),Input.register("UtFile",UtFile);class RegisterFunction{constructor(){this.rfs={}}register(t,e){this.rfs.update({n:e})}get(t){return get(this.rfs,t)}}class Button extends Layout{constructor(t){super(t),this.create("button"),this.opts_setup(),console.trace()}opts_setup(){this.opts.orientation&&"horizontal"==this.opts.orientation?(t=new HBox({}),this.orient="h"):(t=new VBox({}),this.orient="v"),t.set_width("100%"),t.set_height("100%"),this.opts.css&&this.set_css(this.opts.css);var t,e,s=this.opts.item_size||"30px";this.opts.icon&&((e=new Image({url:this.opts.icon})).set_width(s),e.set_height(s),"v"==this.orient&&e.h_center(),t.add_widget(e)),this.opts.text&&((e=new Text({text:this.opts.text,fontsize:s,i18n:!0})).set_height(s),t.add_widget(e)),this.add_widget(t)}}Factory.register("Button",Button);
